{"version":3,"file":"index.js","sources":["../../src/modules/components/Container.svelte","../../src/modules/components/ComponentShell.svelte","../../src/modules/helper/localize.js","../../src/modules/components/application/HeaderButton.svelte","../../src/modules/components/application/ApplicationHeader.svelte","../../src/modules/components/application/ApplicationShell.svelte","../../src/modules/components/contextmenu/TJSContextMenu.svelte","../../src/modules/application/SvelteApplication.js","../../src/modules/application/TJSMenu.js"],"sourcesContent":["<script>\r\n   export let warn = false;\r\n   export let children = void 0;\r\n</script>\r\n\r\n{#if Array.isArray(children)}\r\n    {#each children as child}\r\n        <svelte:component this={child.class} {...child.props} />\r\n    {/each}\r\n{:else if warn}\r\n    <p>Container warning: No children.</p>\r\n{/if}\r\n\r\n<style>\r\n    p {\r\n        color: red;\r\n        font-size: 18px;\r\n    }\r\n</style>","<script>\r\n   import { getContext }    from 'svelte';\r\n\r\n   import Container         from './Container.svelte';\r\n\r\n   const context = getContext('external');\r\n   const children = typeof context === 'object' ? context.children : void 0;\r\n</script>\r\n<Container {children} warn={true} />","/**\r\n * Localize a string including variable formatting for input arguments. Provide a string ID which defines the localized\r\n * template. Variables can be included in the template enclosed in braces and will be substituted using those named\r\n * keys.\r\n *\r\n * @param {string}   stringId - The string ID to translate.\r\n *\r\n * @param {object}   [data] - Provided input data.\r\n *\r\n * @returns {string} The translated and formatted string\r\n */\r\nexport function localize(stringId, data)\r\n{\r\n   const result = typeof data !== 'object' ? game.i18n.localize(stringId) : game.i18n.format(stringId, data);\r\n   return result !== void 0 ? result : '';\r\n}","<script>\r\n   /**\r\n    * Provides an app header button conforming to the Foundry {@link ApplicationHeaderButton} type. Additionally a\r\n    * `title` field is supported to give a tool tip for the button. The `onclick` function if defined is invoked when\r\n    * the button is clicked and state is updated accordingly.\r\n    */\r\n   import { localize }  from '../../helper';\r\n\r\n   export let button;\r\n\r\n   function onClick()\r\n   {\r\n      if (typeof button.onclick === 'function')\r\n      {\r\n         button.onclick.call(button);\r\n         button = button;\r\n      }\r\n   }\r\n</script>\r\n<a on:click={onClick} class=header-button>\r\n    <i class={button.icon} title={localize(button.title)}></i>{localize(button.label)}\r\n</a>\r\n","<script>\r\n   import HeaderButton  from './HeaderButton.svelte';\r\n\r\n   export let title = '';\r\n   export let headerButtons = [];\r\n</script>\r\n\r\n<header class=\"window-header flexrow\">\r\n    <h4 class=window-title>{title}</h4>\r\n    {#each headerButtons as button}\r\n        <HeaderButton {button}/>\r\n    {/each}\r\n</header>","<script>\r\n   import { getContext, setContext }   from 'svelte';\r\n\r\n   import ApplicationHeader            from './ApplicationHeader.svelte';\r\n   import Container                    from '../Container.svelte';\r\n\r\n   let content, root;\r\n\r\n   setContext('getElementContent', () => content);\r\n   setContext('getElementRoot', () => root);\r\n\r\n   const context = getContext('external');\r\n   const children = typeof context === 'object' ? context.children : void 0;\r\n\r\n   const foundryApp = getContext('external').foundryApp;\r\n</script>\r\n\r\n<div id={foundryApp.id} class=\"typhonjs-app typhonjs-window-app\" data-appid={foundryApp.appId} bind:this={root}>\r\n    <ApplicationHeader title = {foundryApp.title} headerButtons= {foundryApp._getHeaderButtons()} />\r\n    <section class=window-content bind:this={content}>\r\n        <Container {children} warn={true} />\r\n    </section>\r\n</div>\r\n\r\n<style>\r\n  /* Defines the styles for that mimics a popout Application. `:global` is used to preserve the unused CSS */\r\n  :global(.typhonjs-app) {\r\n    max-height: 100%;\r\n    background: url(/ui/denim075.png) repeat;\r\n    border-radius: 5px;\r\n    box-shadow: 0 0 20px #000;\r\n    margin: 3px 0;\r\n    color: #f0f0e0;\r\n    position: absolute;\r\n  }\r\n\r\n  :global(.typhonjs-window-app) {\r\n    display: flex;\r\n    flex-direction: column;\r\n    flex-wrap: nowrap;\r\n    justify-content: flex-start;\r\n    padding: 0;\r\n    z-index: 99;\r\n  }\r\n\r\n  :global(.typhonjs-window-app .window-content) {\r\n    display: flex;\r\n    flex-direction: column;\r\n    flex-wrap: nowrap;\r\n    justify-content: flex-start;\r\n    padding: 8px;\r\n    color: #191813;\r\n    overflow-y: auto;\r\n    overflow-x: hidden;\r\n  }\r\n\r\n  :global(.typhonjs-window-app .window-header) {\r\n    flex: 0 0 30px;\r\n    overflow: hidden;\r\n    padding: 0 8px;\r\n    line-height: 30px;\r\n    border-bottom: 1px solid #000;\r\n    pointer-events: auto;\r\n  }\r\n\r\n  :global(.typhonjs-window-app .window-header a) {\r\n    flex: none;\r\n    margin: 0 0 0 8px;\r\n  }\r\n\r\n  :global(.typhonjs-window-app .window-header h4) {\r\n    font-family: Signika, sans-serif;\r\n  }\r\n\r\n  :global(.typhonjs-window-app .window-header i[class^=fa]) {\r\n    margin-right: 3px;\r\n  }\r\n\r\n  :global(.typhonjs-window-app .window-header .window-title) {\r\n    margin: 0;\r\n    word-break: break-all;\r\n  }\r\n\r\n  :global(.typhonjs-window-app .window-resizable-handle) {\r\n    width: 20px;\r\n    height: 20px;\r\n    position: absolute;\r\n    bottom: -1px;\r\n    right: 0;\r\n    background: #444;\r\n    padding: 2px;\r\n    border: 1px solid #111;\r\n    border-radius: 4px 0 0 0;\r\n  }\r\n\r\n  :global(.typhonjs-window-app .window-resizable-handle i.fas) {\r\n    transform: rotate(45deg);\r\n  }\r\n\r\n  :global(.typhonjs-window-app.minimized .window-header) {\r\n    border: 1px solid #000;\r\n  }\r\n\r\n  :global(.typhonjs-window-app.minimized .window-resizable-handle) {\r\n    display: none;\r\n  }\r\n</style>","<script>\r\n   import { createEventDispatcher } from 'svelte';\r\n   import { current_component }     from 'svelte/internal';\r\n\r\n   import { localize }              from '@typhonjs-fvtt/svelte/helper';\r\n   import { slideFade }             from '@typhonjs-fvtt/svelte/transition';\r\n   import { outroAndDestroy }       from '@typhonjs-fvtt/svelte/util';\r\n\r\n   export let id = '';\r\n   export let x = 0;\r\n   export let y = 0;\r\n   export let items = [];\r\n   export let transitionOptions = void 0;\r\n\r\n   // Bound to the nav element / menu.\r\n   let menuEl;\r\n\r\n   // Store this component reference.\r\n   const local = current_component;\r\n\r\n   // Dispatches `close` event.\r\n   const dispatch = createEventDispatcher();\r\n\r\n   /**\r\n    * Provides a custom animate callback allowing inspection of the element to change positioning styles based on the\r\n    * height / width of the element and `document.body`. This allows the context menu to expand up when the menu\r\n    * is outside the height bound of `document.body` and expand to the left if width is greater than `document.body`.\r\n    *\r\n    * @param {HTMLElement} node - nav element.\r\n    *\r\n    * @returns {object} Transition object.\r\n    */\r\n   function animate(node)\r\n   {\r\n      const expandUp = y + node.clientHeight > document.body.clientHeight\r\n      const expandLeft = x + node.clientWidth > document.body.clientWidth\r\n\r\n      node.style.top = expandUp ? null : `${y}px`;\r\n      node.style.bottom = expandUp ? `${document.body.clientHeight - y}px` : null;\r\n\r\n      node.style.left = expandLeft ? null : `${x}px`;\r\n      node.style.right = expandLeft ? `${document.body.clientWidth - x}px` : null;\r\n\r\n      return slideFade(node, transitionOptions);\r\n   }\r\n\r\n   /**\r\n    * Invokes a function on click of a menu item then fires the `close` event and automatically runs the outro\r\n    * transition and destroys the component.\r\n    *\r\n    * @param {function} callback - Function to invoke on click.\r\n    */\r\n   function onClick(callback)\r\n   {\r\n      if (typeof callback === 'function') { callback(); }\r\n\r\n      dispatch('close');\r\n      outroAndDestroy(local);\r\n   }\r\n\r\n   /**\r\n    * Determines if a pointer pressed to the document body closes the context menu. If the click occurs outside the\r\n    * context menu then fire the `close` event and run the outro transition then destroy the component.\r\n    *\r\n    * @param {PointerEvent}   event - Pointer event from document body click.\r\n    */\r\n   function onClose(event)\r\n   {\r\n      if (event.target === menuEl || menuEl.contains(event.target)) { return; }\r\n\r\n      dispatch('close');\r\n      outroAndDestroy(local);\r\n   }\r\n</script>\r\n<!-- bind to `document.body` to receive pointer down events to close the context menu. -->\r\n<svelte:body on:pointerdown={onClose}/>\r\n\r\n<nav id={id} class=tjs-context-menu transition:animate bind:this={menuEl}>\r\n    <ol class=tjs-context-items>\r\n        {#each items as item}\r\n            <li class=tjs-context-item on:click={() => onClick(item.onclick)}><i class={item.icon}></i>{localize(item.label)}</li>\r\n        {/each}\r\n    </ol>\r\n</nav>\r\n\r\n<style>\r\n    .tjs-context-menu {\r\n        position: fixed;\r\n        width: fit-content;\r\n        font-size: 14px;\r\n        box-shadow: 0 0 10px #000;\r\n        height: max-content;\r\n        min-width: 150px;\r\n        max-width: 360px;\r\n        background: #23221d;\r\n        border: 1px solid #000;\r\n        border-radius: 5px;\r\n        color: #EEE;\r\n        z-index: 10000;\r\n    }\r\n\r\n    .tjs-context-menu ol.tjs-context-items {\r\n        list-style: none;\r\n        margin: 0;\r\n        padding: 0;\r\n    }\r\n\r\n    .tjs-context-menu li.tjs-context-item {\r\n        padding: 0 5px;\r\n        line-height: 32px;\r\n    }\r\n\r\n    .tjs-context-menu li.tjs-context-item:hover {\r\n        color: #FFF;\r\n        text-shadow: 0 0 4px red;\r\n    }\r\n\r\n    .tjs-context-menu li.tjs-context-item > i {\r\n        margin-right: 5px;\r\n    }\r\n</style>","/**\r\n * Provides a Svelte aware extension to Application to control the app lifecycle appropriately. You can declaratively\r\n * load one or more components from `defaultOptions`. For the time being please refer to this temporary demo code\r\n * in `typhonjs-quest-log` for examples of how to declare Svelte components.\r\n * {@link https://github.com/typhonjs-fvtt/typhonjs-quest-log/tree/master/src/view/demo}\r\n *\r\n * A repository of demos will be available soon.\r\n */\r\nexport default class SvelteApplication extends Application\r\n{\r\n   /**\r\n    * Stores instantiated Svelte components.\r\n    *\r\n    * @type {object[]}\r\n    * @private\r\n    */\r\n   #svelteComponents = [];\r\n\r\n   /**\r\n    * @inheritDoc\r\n    */\r\n   constructor(options)\r\n   {\r\n      super(options);\r\n   }\r\n\r\n   /**\r\n    * Note: This method is fully overridden and duplicated as Svelte components need to be destroyed manually and the\r\n    * best visual result is to destroy them after the default JQuery slide up animation occurs, but before the element\r\n    * is removed from the DOM.\r\n    *\r\n    * If you destroy the Svelte components before the slide up animation the Svelte elements are removed immediately\r\n    * from the DOM. The purpose of overriding ensures the slide up animation is always completed before\r\n    * the Svelte components are destroyed and then the element is removed from the DOM.\r\n    *\r\n    * Close the application and un-register references to it within UI mappings.\r\n    * This function returns a Promise which resolves once the window closing animation concludes\r\n    *\r\n    * @param {object}   options - Optional parameters.\r\n    *\r\n    * @param {boolean}  options.force - Force close regardless of render state.\r\n    *\r\n    * @returns {Promise<void|number>}    A Promise which resolves once the application is closed\r\n    */\r\n   async close(options = {})\r\n   {\r\n      const states = Application.RENDER_STATES;\r\n      if (!options.force && ![states.RENDERED, states.ERROR].includes(this._state)) { return; }\r\n\r\n      this._state = states.CLOSING;\r\n\r\n      /**\r\n       * Get the element.\r\n       *\r\n       * @type {JQuery}\r\n       */\r\n      const el = this.element;\r\n      if (!el) { return this._state = states.CLOSED; }\r\n\r\n      el.css({ minHeight: 0 });\r\n\r\n      // Dispatch Hooks for closing the base and subclass applications\r\n      for (const cls of this.constructor._getInheritanceChain())\r\n      {\r\n         /**\r\n          * A hook event that fires whenever this Application is closed.\r\n          *\r\n          * @param {Application} app                     The Application instance being closed\r\n          *\r\n          * @param {jQuery[]} html                       The application HTML when it is closed\r\n          *\r\n          * @function closeApplication\r\n          *\r\n          * @memberof hookEvents\r\n          */\r\n         Hooks.call(`close${cls.name}`, this, el);\r\n      }\r\n\r\n      // Animate closing the element\r\n      return new Promise((resolve) =>\r\n      {\r\n         el.slideUp(200, () =>\r\n         {\r\n            // Manually invoke the destroy callbacks for all Svelte components.\r\n            for (const entry of this.#svelteComponents)\r\n            {\r\n               entry.component?.$destroy();\r\n\r\n               const eventbus = entry.config.eventbus;\r\n               if (typeof eventbus === 'object' && typeof eventbus.off === 'function')\r\n               {\r\n                  eventbus.off();\r\n                  entry.config.eventbus = void 0;\r\n               }\r\n            }\r\n\r\n            this.#svelteComponents = [];\r\n\r\n            el.remove();\r\n\r\n            // Clean up data\r\n            this._element = null;\r\n            delete ui.windows[this.appId];\r\n            this._minimized = false;\r\n            this._scrollPositions = null;\r\n            this._state = states.CLOSED;\r\n            resolve();\r\n         });\r\n      });\r\n   }\r\n\r\n   /**\r\n    * Returns the indexed Svelte component\r\n    * @param {number}   index -\r\n    *\r\n    * @returns {object}\r\n    */\r\n   getSvelteComponent(index)\r\n   {\r\n      return this.#svelteComponents[index];\r\n   }\r\n\r\n   /**\r\n    * Inject the Svelte components defined in `this.options.svelte`. The Svelte component can attach to the existing\r\n    * pop-out of Application or provide no template and render into a document fragment which is then attached to the\r\n    * DOM.\r\n    *\r\n    * @param {JQuery} html -\r\n    *\r\n    * @override\r\n    * @inheritDoc\r\n    */\r\n   _injectHTML(html)\r\n   {\r\n      if (this.popOut && html.length === 0 && Array.isArray(this.options.svelte))\r\n      {\r\n         throw new Error(\r\n          'SvelteApplication - _injectHTML - A popout app with no template can only support one Svelte component.');\r\n      }\r\n\r\n      if (Array.isArray(this.options.svelte))\r\n      {\r\n         for (const svelteConfig of this.options.svelte)\r\n         {\r\n            this.#svelteComponents.push(s_LOAD_CONFIG(this, html, svelteConfig));\r\n         }\r\n      }\r\n      else if (typeof this.options.svelte === 'object')\r\n      {\r\n         this.#svelteComponents.push(s_LOAD_CONFIG(this, html, this.options.svelte));\r\n      }\r\n      else\r\n      {\r\n         throw new TypeError(`SvelteApplication - _injectHTML - this.options.svelte not an array or object.`);\r\n      }\r\n\r\n      // Detect if this is a synthesized DocumentFragment.\r\n      const isDocumentFragment = html.length && html[0] instanceof DocumentFragment && html[0].firstElementChild;\r\n\r\n      // Store first child element if DocumentFragment.\r\n      const newElement = isDocumentFragment ? $(html[0].firstElementChild) : void 0;\r\n\r\n      super._injectHTML(html);\r\n\r\n      // Set the element of the app to the first child of any document fragment.\r\n      if (isDocumentFragment)\r\n      {\r\n         this._element = newElement;\r\n      }\r\n\r\n      this.onSvelteMount(this.element);\r\n   }\r\n\r\n   /**\r\n    * Provides a callback after all Svelte components are initialized.\r\n    *\r\n    * @param {JQuery} element - JQuery container for main application element.\r\n    */\r\n   onSvelteMount(element) {} // eslint-disable-line no-unused-vars\r\n\r\n   /**\r\n    * Override replacing HTML as Svelte components control the rendering process. Only potentially change the outer\r\n    * application frame / title for pop-out applications.\r\n    *\r\n    * @override\r\n    * @inheritDoc\r\n    */\r\n   _replaceHTML(element, html)  // eslint-disable-line no-unused-vars\r\n   {\r\n      if (!element.length) { return; }\r\n\r\n      // For pop-out windows update the window title\r\n      if (this.popOut)\r\n      {\r\n         element.find('.window-title').text(this.title);\r\n      }\r\n   }\r\n\r\n   /**\r\n    * Render the inner application content. Only render a template if one is defined otherwise provide an empty\r\n    * JQuery element.\r\n    *\r\n    * @param {Object} data         The data used to render the inner template\r\n    *\r\n    * @returns {Promise.<JQuery>}   A promise resolving to the constructed jQuery object\r\n    *\r\n    * @override\r\n    * @private\r\n    */\r\n   async _renderInner(data)\r\n   {\r\n      const html = typeof this.template === 'string' ? await renderTemplate(this.template, data) :\r\n       document.createDocumentFragment();\r\n\r\n      return $(html);\r\n   }\r\n}\r\n\r\n/**\r\n * Instantiates and attaches a Svelte component to the main inserted HTML.\r\n *\r\n * @param {Application} app - The application\r\n *\r\n * @param {JQuery}      html - The inserted HTML.\r\n *\r\n * @param {object}      config - Svelte component options\r\n *\r\n * @returns {object} The config + instantiated Svelte component.\r\n */\r\nfunction s_LOAD_CONFIG(app, html, config)\r\n{\r\n   const svelteOptions = typeof config.options === 'object' ? config.options : {};\r\n\r\n   const injectApp = typeof svelteOptions.injectApp === 'boolean' ? svelteOptions.injectApp : false;\r\n   const injectEventbus = typeof svelteOptions.injectEventbus === 'boolean' ? svelteOptions.injectEventbus : false;\r\n   const hasTemplate = typeof app.template === 'string';\r\n   const hasTarget = typeof config.target === 'string';\r\n\r\n   if (typeof config.class !== 'function')\r\n   {\r\n      throw new TypeError(\r\n       `SvelteApplication - s_LOAD_CONFIG - class not a constructor for config:\\n${JSON.stringify(config)}.`);\r\n   }\r\n\r\n   if (hasTemplate && !hasTarget)\r\n   {\r\n      throw new TypeError(`SvelteApplication - s_LOAD_CONFIG - target selector not a string for config:\\n${\r\n       JSON.stringify(config)}`);\r\n   }\r\n\r\n   // If a target selector is defined then find it in the JQuery `html` otherwise create an empty fragment.\r\n   const target = hasTarget ? html.find(config.target).get(0) : document.createDocumentFragment();\r\n\r\n   if (target === void 0)\r\n   {\r\n      throw new Error(\r\n       `SvelteApplication - s_LOAD_CONFIG - could not find target selector: ${config.target} for config:\\n${\r\n        JSON.stringify(config)}`);\r\n   }\r\n\r\n   const SvelteComponent = config.class;\r\n\r\n   if (typeof SvelteComponent !== 'function')\r\n   {\r\n      throw new Error(\r\n       `SvelteApplication - s_LOAD_CONFIG - class is not defined for config:\\n${JSON.stringify(config)}`);\r\n   }\r\n\r\n   const svelteConfig = { ...config, target  };\r\n\r\n   delete svelteConfig.options;\r\n\r\n   let externalContext = {};\r\n\r\n   // If a context callback function is provided then invoke it with `this` being the Foundry app.\r\n   // If an object is returned it adds the entries to external context.\r\n   if (typeof svelteConfig.context === 'function')\r\n   {\r\n      const context = svelteConfig.context;\r\n      delete svelteConfig.context;\r\n\r\n      const result = context.call(app);\r\n      if (typeof result === 'object')\r\n      {\r\n         externalContext = { ...externalContext, ...result };\r\n      }\r\n   }\r\n\r\n   // Process children components attaching to external context.\r\n   if (Array.isArray(svelteConfig.children))\r\n   {\r\n      externalContext.children = [];\r\n      for (let cntr = 0; cntr < svelteConfig.children.length; cntr++)\r\n      {\r\n         const child = svelteConfig.children[cntr];\r\n\r\n         if (typeof child.class !== 'function')\r\n         {\r\n            throw new Error(\r\n             `SvelteApplication - s_LOAD_CONFIG - class is not defined for child[${cntr}] for config:\\n${\r\n              JSON.stringify(config)}`);\r\n         }\r\n\r\n         externalContext.children.push(child);\r\n      }\r\n\r\n      delete svelteConfig.children;\r\n   }\r\n   else if (typeof svelteConfig.children === 'object')\r\n   {\r\n      if (typeof svelteConfig.children.class !== 'function')\r\n      {\r\n         throw new Error(\r\n          `SvelteApplication - s_LOAD_CONFIG - class is not defined for children object for config:\\n${\r\n           JSON.stringify(config)}`);\r\n      }\r\n\r\n      externalContext.children = [svelteConfig.children];\r\n      delete svelteConfig.children;\r\n   }\r\n\r\n   // Potentially inject the Foundry application instance as a Svelte prop.\r\n   if (injectApp)\r\n   {\r\n      externalContext.foundryApp = app;\r\n   }\r\n\r\n   let eventbus;\r\n\r\n   // Potentially inject any TyphonJS eventbus and track the proxy in the options.\r\n   if (injectEventbus && typeof app._eventbus === 'object' && typeof app._eventbus.createProxy === 'function')\r\n   {\r\n      eventbus = app._eventbus.createProxy();\r\n      externalContext.eventbus = eventbus;\r\n   }\r\n\r\n   // If there is a context object then set it to props.\r\n   if (Object.keys(externalContext).length > 0)\r\n   {\r\n      // If there is an existing context Map then merge with external context.\r\n      svelteConfig.context = svelteConfig.context instanceof Map ?\r\n       new Map([['external', externalContext], ...svelteConfig.context]) :\r\n        new Map([['external', externalContext]]);\r\n   }\r\n\r\n   // Create the Svelte component.\r\n   const component = new SvelteComponent(svelteConfig);\r\n\r\n   // Set any eventbus to the config.\r\n   svelteConfig.eventbus = eventbus;\r\n\r\n   const result = { config: svelteConfig, component };\r\n\r\n   if (!hasTarget)\r\n   {\r\n      html.append(target);\r\n   }\r\n\r\n   return result;\r\n}","import { outroAndDestroy } from '@typhonjs-fvtt/svelte/util';\r\n\r\nimport TJSContextMenu      from '../components/contextmenu/TJSContextMenu.svelte';\r\n\r\n/**\r\n * Provides game wide menu functionality.\r\n */\r\nexport default class TJSMenu\r\n{\r\n   /**\r\n    * Stores any active context menu.\r\n    */\r\n   static #contextMenu = void 0;\r\n\r\n   /**\r\n    * Stores the current active async state which is used when async is true.\r\n    *\r\n    * @type {{x: number, active: boolean, y: number}}\r\n    */\r\n   static #contextMenuData = { active: false, x: -1, y: -1 };\r\n\r\n   /**\r\n    * Creates and manages a game wide context menu.\r\n    *\r\n    * @param {object}   opts - Optional parameters.\r\n    *\r\n    * @param {boolean}  [opts.async=false] - Awaits the outro transition of an existing menu before displaying next.\r\n    *\r\n    * @param {string}   [opts.id] - A custom CSS ID to add to the menu.\r\n    *\r\n    * @param {number}   opts.x - X position for the top / left of the menu.\r\n    *\r\n    * @param {number}   opts.y - Y position for the top / left of the menu.\r\n    *\r\n    * @param {object[]} opts.items - Menu items to display.\r\n    *\r\n    * @param {...*}     [opts.transitionOptions] - The rest of opts defined the slideFade transition options.\r\n    *\r\n    * @returns {Promise<void>}\r\n    */\r\n   static async createContext({ async = false, id = '', x = 0, y = 0, items = [], ...transitionOptions } = {})\r\n   {\r\n      // Gates multiple repeat context clicks when a context menu already exists w/ same x & y.\r\n      if (this.#contextMenu !== void 0 && x === this.#contextMenuData.x && y === this.#contextMenuData.y) { return; }\r\n\r\n      // Always set the last context menu click point. When async is enabled this allows the last click to be the\r\n      // position where the new context menu will display if multiple context clicks occur before the existing menu\r\n      // outro transition is completed.\r\n      this.#contextMenuData.x = x;\r\n      this.#contextMenuData.y = y;\r\n\r\n      // A latch to return if a previous menu is being destroyed and outro transition is still playing when async is\r\n      // enabled.\r\n      if (this.#contextMenuData.active) { return; }\r\n\r\n      // Set the active state to true. This provides the latch above when async is enabled.\r\n      this.#contextMenuData.active = true;\r\n\r\n      // Destroy the existing menu an play the outro transition.\r\n      if (this.#contextMenu !== void 0)\r\n      {\r\n         const menu = this.#contextMenu;\r\n         this.#contextMenu = void 0;\r\n\r\n         // Await on outroAndDestroy when async is enabled otherwise immediately continue.\r\n         if (async) { await outroAndDestroy(menu); }\r\n         else { outroAndDestroy(menu); }\r\n      }\r\n\r\n      // Create the new context menu with the last click x / y point.\r\n      this.#contextMenu = new TJSContextMenu({\r\n         target: document.body,\r\n         intro: true,\r\n         props: { id, x: this.#contextMenuData.x, y: this.#contextMenuData.y, items, transitionOptions }\r\n      });\r\n\r\n      // Register an event listener to remove any active context menu if closed from a menu selection, etc.\r\n      this.#contextMenu.$on('close', () =>\r\n      {\r\n         if (this.#contextMenu !== void 0)\r\n         {\r\n            const menu = this.#contextMenu;\r\n            this.#contextMenu = void 0;\r\n            outroAndDestroy(menu);\r\n         }\r\n      });\r\n\r\n      this.#contextMenuData.active = false;\r\n   }\r\n}"],"names":["localize","stringId","data","result","game","i18n","format","SvelteApplication","Application","constructor","options","close","states","RENDER_STATES","force","RENDERED","ERROR","includes","_state","CLOSING","el","element","CLOSED","css","minHeight","cls","_getInheritanceChain","Hooks","call","name","Promise","resolve","slideUp","entry","component","$destroy","eventbus","config","off","remove","_element","ui","windows","appId","_minimized","_scrollPositions","getSvelteComponent","index","_injectHTML","html","popOut","length","Array","isArray","svelte","Error","svelteConfig","push","s_LOAD_CONFIG","TypeError","isDocumentFragment","DocumentFragment","firstElementChild","newElement","$","onSvelteMount","_replaceHTML","find","text","title","_renderInner","template","renderTemplate","document","createDocumentFragment","app","svelteOptions","injectApp","injectEventbus","hasTemplate","hasTarget","target","class","JSON","stringify","get","SvelteComponent","externalContext","context","children","cntr","child","foundryApp","_eventbus","createProxy","Object","keys","Map","append","TJSMenu","createContext","async","id","x","y","items","transitionOptions","active","menu","outroAndDestroy","TJSContextMenu","body","intro","props","$on"],"mappings":"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"}